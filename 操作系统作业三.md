# 操作系统作业三

## 1

**请问进程整个的地址空间有多少字节？一页有多少字节？**

整个地址空间有4GB字节，一页有4KB字节。

**求第一级页表（页目录）的起始逻辑地址，并指出从哪个逻辑地址可以读出第一级页表（页目录）所在的物理页框号。**

页表基址`PT_base`=0x8000_0000，页目录基址`PD_base` = `PT_base` + `PT_base` >> 10 = 0x8020_0000,自映射目录表项`PDE_self_mapping` = `PT_base` + `PT_base` >> 10 + `PT_base` >> 20 = 0x8020_0800。

**地址转换**

访问0x0：页目录号是0，访问页目录项0，有效标志为0，页面未装入，引发缺页中断。

访问0x0080_3004：查页目录项0002，有效标志为1，页表物理地址0x5000。查0x5000处的页表项0003，0x2_0001，有效标志为1，页面物理地址为0x2_0000。原地址页内偏移位0b0000_0000_0100，访问的数据为0x0000_0000。

访问0x0040_2001：查页目录项0001，有效标志为1，页表物理地址0x1000。查0x1000处的页表项0002，0x5001，有效标志为1，页面物理地址为0x5000。原地址页内偏移位0b0000_0000_0001，访问的数据为0b0000_0000。

若要访问物理地址0x32_6028，该物理地址的低12位0x028是页内偏移，物理页框号0x32_6000，可知虚拟地址页内偏移位为0b0000_0010_1000。在上图所示的页表内容中查到0x2_0000处页表的0001偏移处存有该物理页框号且有效位为1，可知虚拟地址的页表偏移位为0b00_0000_0001。从页目录中查到页目录项0003中页表物理地址为0x2_0000且标志位为1，可知虚拟地址页目录位为0b00_0000_0011。综上，虚拟地址为0b0000_0000_1100_0000_0001_0000_0010_1000，即0x00c0_1028。

## 2

### Load [0x00001022]

一级页表项偏移量为0，对应一级页表项地址为0x0020_0000，内容为0x0010_0007，有效且可读，二级页表地址为0x0010_0000，二级页表项偏移量为1，对应二级页表项地址为0x0010_0004，内容为0x0000_4067，有效且可读，物理页框号为0x00004，偏移量为0x022，物理地址为0x0000_4022，内容为0x20。

### Store [0x00C07222]

一级页表偏移量为3，对应一级页表项地址为0x0020_000c，内容为0x0010_3007，有效且可写，二级页表地址为0x0010_3000，二级页表项偏移量为7，对应二级页表项地址为0x0010_301c，内容为0xeeff_0001，有效但不可写，Error。

### Store[0x00C005BF]

一级页表偏移量为3，对应一级页表项地址为0x0020_000c，内容为0x0010_3007，有效且可写，二级页表地址为0x0010_3000，二级页表项偏移量为0，对应二级页表项地址为0x0010_3000，内容为0x1122_0067，有效且可写，物理页框号为0x11220，偏移量为0x5bf，写入地址为0x1122_05bf。

### Load [0x00003013]

一级页表项偏移量为0，对应一级页表项地址为0x0020_0000，内容为0x0010_0007，有效且可读，二级页表地址为0x0010_0000，二级页表项偏移量为3，对应二级页表项地址为0x0010_000c，内容为0x0000_4007，有效且可读，物理页框号为0x00004，偏移量为0x013，物理地址为0x0000_4013，内容为0x19。

### Load [0xFF80078F]

一级页表项偏移量为0x3fe，对应一级页表项地址为0x0020_0ff8，内容为0x001f_e007，有效且可读，二级页表地址为0x001f_e000，二级页表项偏移量为0，对应二级页表项地址为0x001f_e000， 内容为0x0415_0000，无效，Error。

### Load [0xFFFFF005]

一级页表项偏移量为0x3ff，对应一级页表项地址为0x0020_0ffc，内容为0x001f_f007，有效且可读，二级页表地址为0x001f_f000，二级页表项偏移量为0x3ff，对应二级页表项地址为0x001f_fffc，内容为0x0010_3067，有效且可读，物理页框号为0x00103，偏移量为0x005，物理地址为0x0010_3005，内容为0x66。